# Story 3.1: Transaction Creation via Simple Text Input

## Story Overview
**Epic:** Epic 3: AI-Powered Transaction Input  
**Story ID:** 3.1  
**Priority:** High  
**Estimated Effort:** 3-4 developer days  

## User Story
**As a** user  
**I want to** type a simple sentence into a chat interface to create a transaction  
**So that** I can log expenses quickly using natural language instead of filling out forms  

## Acceptance Criteria

### Given-When-Then Scenarios

#### Scenario 1: Basic Text Transaction Creation
**Given** I am logged into the Finance Tracker application  
**When** I type "50 EGP for lunch at McDonalds" in the chat interface and submit  
**Then** the system should send the text to the `/text/llm/` API  
**And** display a transaction confirmation modal with extracted details:
- Amount: 50
- Currency: EGP
- Type: Expense
- Category: Food & Dining
- Description: "Lunch at McDonalds"
- Date: Today's date

#### Scenario 2: Income Transaction Processing
**Given** I am on the main dashboard with the chat interface  
**When** I type "Received 1000 EGP salary from company" and submit  
**Then** the system should extract and display:
- Amount: 1000
- Currency: EGP
- Type: Income
- Category: Salary
- Description: "Salary from company"

#### Scenario 3: Complex Transaction with Date
**Given** I am using the chat interface  
**When** I type "Paid 200 EGP for groceries at Carrefour yesterday"  
**Then** the system should extract:
- Amount: 200
- Type: Expense
- Category: Groceries
- Description: "Groceries at Carrefour"
- Date: Yesterday's date

#### Scenario 4: API Error Handling
**Given** the LLM API service is unavailable  
**When** I submit a text transaction  
**Then** the system should display an error message  
**And** offer a fallback option to create the transaction manually  
**And** not lose my input text

#### Scenario 5: Low Confidence Extraction
**Given** I submit ambiguous text like "spent some money today"  
**When** the LLM API returns low confidence results  
**Then** the system should highlight uncertain fields in the confirmation modal  
**And** suggest that I review and edit the extracted details

## Technical Requirements

### API Integration
- **LLM Endpoint:** `POST /text/llm/`
- **Request Format:**
  ```typescript
  {
    text: string,
    context: {
      userId: string,
      accounts: Account[],
      recentCategories: string[]
    }
  }
  ```
- **Expected Response:**
  ```typescript
  {
    success: boolean,
    data: {
      amount: number,
      type: 'income' | 'expense',
      category: string,
      description: string,
      date: string,
      confidence: number,
      extractedFields: {
        merchant?: string,
        location?: string,
        currency?: string
      }
    },
    error?: string
  }
  ```

### UI Components Required
1. **Chat Interface Component**
   - Text input field with submit button
   - Message history display
   - Loading states during API calls
   - Error message display

2. **Transaction Confirmation Modal**
   - Editable fields for all transaction details
   - Account selection dropdown
   - Confidence indicators for extracted fields
   - Confirm/Cancel buttons

3. **Integration Points**
   - Existing transaction creation API
   - Account management system
   - Category validation
   - User authentication context

### Performance Requirements
- API response time should be < 3 seconds
- UI should show loading state immediately on submit
- Graceful handling of network timeouts
- Offline capability with queued requests

## Implementation Tasks

### Backend Tasks
1. **Create LLM API Integration Service**
   - Implement API client for `/text/llm/` endpoint
   - Add request/response type definitions
   - Implement error handling and retries
   - Add logging for API calls and responses

2. **Extend Transaction API**
   - Add endpoint for AI-assisted transaction creation
   - Implement validation for AI-extracted data
   - Add confidence scoring and field highlighting
   - Ensure compatibility with existing transaction creation

3. **Context Enhancement**
   - Pass user's recent categories to LLM for better extraction
   - Include user's account information for context
   - Implement smart defaults based on user history

### Frontend Tasks
1. **Chat Interface Component**
   - Create responsive chat UI component
   - Implement text input with proper validation
   - Add loading states and error handling
   - Integrate with existing app layout

2. **Transaction Confirmation Modal**
   - Build modal with editable transaction fields
   - Implement confidence indicators and field highlighting
   - Add account selection and category validation
   - Handle form submission and error states

3. **State Management**
   - Implement chat message history
   - Manage transaction draft state
   - Handle API loading and error states
   - Integrate with existing transaction state

## Testing Requirements

### Unit Tests
- LLM API integration service
- Transaction extraction validation
- Chat interface component interactions
- Confirmation modal form handling

### Integration Tests
- End-to-end text-to-transaction flow
- API error handling scenarios
- Transaction creation with AI-extracted data
- Account and category integration

### User Acceptance Tests
- Natural language processing accuracy
- User workflow from text input to saved transaction
- Error recovery and fallback scenarios
- Performance under various network conditions

## Definition of Done
- [ ] User can input natural language text and create transactions
- [ ] LLM API integration is robust with proper error handling
- [ ] Transaction confirmation modal allows editing of extracted details
- [ ] All acceptance criteria scenarios pass
- [ ] Unit and integration tests achieve 90%+ coverage
- [ ] Performance requirements are met
- [ ] Error handling covers all failure scenarios
- [ ] Documentation is updated for new API endpoints
- [ ] Code review completed and approved
- [ ] QA testing completed with no critical issues

## Dependencies
- **Upstream:** Epic 2 completion (Core Financial Management)
- **External:** LLM API service availability and documentation
- **Internal:** Existing transaction API and account management system

## Risks and Mitigations
- **Risk:** LLM API accuracy issues
  - **Mitigation:** Implement confidence thresholds and user validation
- **Risk:** API service downtime
  - **Mitigation:** Graceful fallback to manual transaction creation
- **Risk:** Performance issues with API calls
  - **Mitigation:** Implement caching and request optimization

## Notes
- This story establishes the foundation for all AI-powered transaction input
- Focus on user experience and accuracy over advanced features
- Ensure seamless integration with existing manual transaction workflow
- Consider internationalization for Arabic language support in future iterations

---

*Created: 2025-09-23*  
*Story ID: STORY-3.1*  
*Status: Ready for Development*  
*Assigned to: TBD*
