# Story 2.2: Edit and Delete Financial Accounts

## Status
Draft

## Story
**As a** user,
**I want** to be able to edit the name or delete an existing financial account,
**so that** I can keep my account list up to date.

## Acceptance Criteria
1. Each account in the list has options to "Edit" and "Delete"
2. Clicking "Edit" allows the user to change the account's name
3. Clicking "Delete" presents a confirmation prompt before removing the account
4. Deleting an account also deletes all associated transactions

## Tasks / Subtasks
- [ ] Task 1: Extend Account API for Edit and Delete Operations (AC: 1, 3, 4)
  - [ ] Add PUT endpoint for updating account names
  - [ ] Add DELETE endpoint for account deletion
  - [ ] Implement cascade delete for associated transactions
  - [ ] Add proper validation and error handling

- [ ] Task 2: Update AccountCard Component with Edit/Delete Actions (AC: 1, 2)
  - [ ] Add Edit and Delete buttons to AccountCard component
  - [ ] Implement inline edit mode for account names
  - [ ] Add form validation for name changes
  - [ ] Update state management for editing mode

- [ ] Task 3: Implement Delete Confirmation Modal (AC: 3, 4)
  - [ ] Create confirmation modal component
  - [ ] Show warning about transaction deletion
  - [ ] Implement modal state management
  - [ ] Add proper user feedback and error handling

- [ ] Task 4: Update Account Types and Service Layer (AC: 2, 4)
  - [ ] Add UpdateAccountRequest interface
  - [ ] Extend AccountService with update and delete methods
  - [ ] Add transaction cascade deletion logic
  - [ ] Implement optimistic UI updates

- [ ] Task 5: Testing and Integration (All ACs)
  - [ ] Create unit tests for new API endpoints
  - [ ] Test AccountCard edit/delete functionality
  - [ ] Test cascade deletion of transactions
  - [ ] Add integration tests for complete flows
  - [ ] Verify error handling and validation

## Dev Notes

### Previous Story Insights
Building on Story 2.1 implementation:
- Account management infrastructure already established [Source: Story 2.1 Dev Agent Record]
- AccountService class provides foundation for CRUD operations [Source: Story 2.1 File List]
- AccountCard component structure ready for enhancement [Source: Story 2.1 Implementation]
- Authentication and demo mode patterns established [Source: Story 2.1 Debug Log]

### Data Models
Account table structure: [Source: architecture/3-database-schema.md]
```sql
accounts table:
- id (UUID, PK)
- user_id (FK → users.id)
- name (e.g. Bank, Cash, Visa)
- type (bank, cash, wallet, credit_card)
- balance (calculated)
- created_at
```

Transaction table for cascade deletion: [Source: architecture/3-database-schema.md]
```sql
transactions table:
- id (UUID, PK)
- user_id (FK → users.id)
- account_id (FK → accounts.id)
- amount
- type (income/expense)
- category
- description
- date
- created_at
```

New interfaces needed:
```typescript
interface UpdateAccountRequest {
  name: string;
}

interface DeleteAccountResponse {
  deletedAccountId: string;
  deletedTransactionCount: number;
}
```

### API Specifications
New endpoints to be created: [Source: Story 2.1 patterns]
- `PUT /api/accounts/{id}` → Update account name for authenticated user
- `DELETE /api/accounts/{id}` → Delete account and cascade transactions
- Update request payload: `{ name: string }`
- Delete response format: `{ deletedAccountId: string, deletedTransactionCount: number }`

### Component Specifications
UI components to be updated: [Source: architecture/source-tree.md]
- **AccountCard**: Add edit/delete buttons and inline edit mode
- **EditAccountModal**: Optional modal for name editing (alternative to inline)
- **DeleteConfirmationModal**: Warning modal for account deletion
- **AccountsPage**: Handle edit/delete state and optimistic updates

### File Locations
Based on Next.js 15.5.3 App Router structure: [Source: architecture/source-tree.md]
- Extend API routes: `/src/app/api/accounts/[id]/route.ts` (new)
- Update components: `/src/components/accounts/AccountCard.tsx` (existing)
- New modals: `/src/components/accounts/DeleteConfirmationModal.tsx` (new)
- Update types: `/src/types/account.ts` (existing)
- Update service: `/src/lib/accounts.ts` (existing)

### Technical Constraints
- Next.js 15.5.3 with App Router compatibility [Source: architecture/tech-stack.md]
- Supabase PostgreSQL database integration [Source: architecture/tech-stack.md]
- BetterAuth authentication for user context [Source: architecture/tech-stack.md]
- TypeScript strict mode compliance [Source: architecture/coding-standards.md]
- Tailwind CSS for styling consistency [Source: architecture/tech-stack.md]

### Cascade Deletion Logic
Account deletion approach: [Source: architecture/3-database-schema.md]
- Delete all transactions associated with account_id first
- Then delete the account record
- Return count of deleted transactions for user feedback
- Ensure deletion is atomic (use transactions if needed)
- Update account balance calculations for remaining accounts

### Testing Standards
Testing requirements for edit/delete functionality: [Source: architecture/coding-standards.md]
- Test file location: `src/__tests__/components/accounts/` directory
- Use Jest and React Testing Library [Source: architecture/tech-stack.md]
- API endpoint testing with mocked database
- User interaction testing for edit/delete flows
- Cascade deletion validation tests

Specific testing requirements for this story:
- Account name edit validation tests
- Delete confirmation modal tests
- Cascade deletion functionality tests
- API endpoint CRUD operation tests
- Optimistic UI update tests

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-23 | 1.0 | Initial story creation for account edit/delete functionality | BMad Master |

## Dev Agent Record

### Agent Model Used
(To be populated by development agent)

### Debug Log References
(To be populated by development agent)

### Completion Notes List
(To be populated by development agent)

### File List
(To be populated by development agent)

## QA Results
(To be populated by QA agent after implementation)
